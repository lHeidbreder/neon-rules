%Custom Environments
\newenvironment{exampleblock}[1][1]
{
	\par
	\vspace{-5mm}
	\hfill
	\begin{minipage}
		{\dimexpr\columnwidth-#1cm}
	\begin{mdframed}[
		backgroundcolor=Gray!65,
		rightline=false,
		topline=false
		]
}{
	\end{mdframed}
	\end{minipage}
	\par
}

%%shortened itemize
\newenvironment{sitemize}[1][10]
{
	\begin{itemize}
	\vspace{-#1mm}
	\setlength\itemsep{-#1mm}
}{
	\end{itemize}
}

%Custom Commands
\newcommand{\ul}[1]{\underline{\smash{#1}}}
\newcommand{\breakline}{\vspace{.5cm} \hrule width \columnwidth \relax}
\newcommand{\derivedvalue}[3]{
	\begin{samepage}
	\subsubsection{#1 \textsubscript{\textlangle#2\textrangle}}
	\hfill
	\begin{minipage}{\dimexpr\columnwidth-1cm}
		#3
	\end{minipage}
	\end{samepage}
	\par
}
\newcommand{\specialrule}[2]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1:}}\\
		#2
	\end{minipage}
    \par
}
\newcommand{\supply}[4]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1}}\\
		\textit{Price: cR #3}\\
		\textit{Weight: #4 kg}\\
		#2
	\end{minipage}
    \par
}
\newcommand{\service}[4]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1}}\\
		#2\\
		\textit{Cost:} #3 per #4
	\end{minipage}
	\par
}
\newcommand{\statuseffect}[2]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1:}}\\
		#2\\
	\end{minipage}
	\vspace{5mm}
}
\newcommand{\skill}[4][Basic]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#2}}\\
		Difficulty: #1\\
		Common Characteristic: #3\\
%		Description:\\
		\textit{#4}\\
	\end{minipage}\par
}
\newcommand{\melee}[2]{\skill{#1}{Melee Base}{#2}}
\newcommand{\ranged}[2]{\skill{#1}{Ranged Base}{#2}}
\newcommand{\ability}[4]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1}} (#2 XP)\\
		\textit{Prerequisites}: #3\\
		\textit{Effect}:\\
		#4\\
	\end{minipage}
}
\newcommand{\maneuver}[3]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{MVR: #1}} (#2 XP)\\
		\textit{Prerequisites: #3\\}
		Effect:\\
		Allows the use of the maneuver \emph{#1} at normal penalties.\\
	\end{minipage}
}
\newcommand{\boon}[4][]{
	\begin{minipage}{\columnwidth}
		\label{boon::#2}
		\textbf{\ul{\smash{#2}}} \mbox{(#4 GP\ifthenelse{\isempty{#1}}{}{ }#1)}\\
		#3
	\end{minipage}
	\par
}
\newcommand{\bane}[4]{
	\boon[#4]{#1}{#2}{#3}
}
\newcommand{\rangedweapon}[9]{
	\vspace{2mm}
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1}}\\
		\textit{#2}\\
		\textbf{Weight}: #9\\
		\textbf{Price}: #8\\
		#3\\
		\textbf{Mag}: #5\\
		\textbf{Reload}: \mbox{#6 actions}\\
		\textbf{Range}: #4\\
		\ifthenelse{\isempty{#7}}{}{\textbf{Special Rules}: #7}
	\end{minipage}
	\par
}
\newcommand{\weaponmod}[5]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1}}\\
		\textit{#3}; \textit{cR #4}; \textit{#5 kg}\\
		#2
	\end{minipage}
	\par
}
\newcommand{\meleecomponent}[6]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1:}}\\
		\textit{#2}\\
		\textbf{Weight}: #4 kg; \textbf{Price}: cR #5\ifthenelse{\isempty{#6}}{}{; \textbf{Requirement}: #6}\\
		\textbf{Effect}: #3
	\end{minipage}
	\par
}
\newcommand{\ammo}[6]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1:}} \textit{#2}\\
		\textbf{Price}: #3; \textbf{Unit of sale}: #4\\
		\textbf{Weight/Bulk}: #5 \textit{\ifthenelse{\isempty{#6}}{each}{per #6}}
	\end{minipage}
	\par
}
\newcommand{\armor}[9]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1}} (covers: #6)\\
		\begin{tabular}{|r|r|r|r|}
			\hline
			Head & Chest & Arms & Legs\\
			\hline
			#2 & #3 & #4 & #5\\
			\hline
		\end{tabular}\par
		\vspace{2mm}
		\textit{Price:} cR #8; \textit{Weight:} #9 kg\\
		#7
	\end{minipage}
	\par
}
\newcommand{\armormod}[6]{
	\begin{minipage}{\columnwidth}
		\textbf{\ul{#1}}\\
		#2\\
		\textit{Price:} #3; \textit{Weight:} #6\\
		\textit{Mod points:} #4\ifthenelse{\isequivalentto{N}{#5}}{}{; Requires power source}
	\end{minipage}
	\par
}
\newcommand{\implant}[7]{
	\begin{minipage}{\columnwidth}
		\textbf{#1}\\
		\textit{#2}\\
		\textit{Effect}: #3\\
		\textit{Price:} cR #6; \textit{Load:} #5\ifthenelse{\isequivalentto{-}{#4}}{}{; \textit{Slot:} #4}\\
		\textit{Available Mods:} #7
	\end{minipage}
	\par
}
\newcommand{\augmod}[3]{
	\begin{minipage}{\columnwidth}
		\textbf{#1}\\
		#2\\
		\textit{Cost:} #3
	\end{minipage}
	\par
}
\newcommand{\mod}[2]{\item \textbf{#1}: #2}
\newcommand{\psicomponent}[4]{\textbf{#1} & #2 & #3 & #4 \\}

%prioritize graphics with fade
\newcommand{\tryincludewithfade}[2][]{
	
	\directlua{
		newpath=string.gsub("#2", ".png$", ".fade.png");
		print(newpath);
		tex.sprint("\\edef\\tmpTryincludewithfade{"..newpath.."}")
	}
	\show\tmpTryincludewithfade
	\IfFileExists{\tmpTryincludewithfade}
		{\includegraphics[#1]{\tmpTryincludewithfade}}
		{\includegraphics[#1]{#2}}
}
%filler images
\newcommand{\filltopageendgraphics}[2][]{%
	\par
	\zsaveposy{top-\thepage}% Mark (baseline of) top of image
	\vfill
	\zsaveposy{bottom-\thepage}% Mark (baseline of) bottom of image
	\smash{\includegraphics[height=\dimexpr\zposy{top-\thepage}sp-\zposy{bottom-\thepage}sp\relax,#1]{#2}}%
	\par
}

%Base Building
\newcommand{\baselocation}[6]{
	\begin{minipage}{\columnwidth}
		\textbf{#1}\\
		Size: #3; Concealment: #4; Defense: #5\\
		Conditions: #6\\
		\textit{Cost:} cR #2
	\end{minipage}
	\par
}
\newcommand{\baseasset}[6]{
	\begin{minipage}{\columnwidth}
		\textbf{#1}\\
		\textit{#2}\\
		Size: #3\\
		Concealment: #4\\
		Defense: #5\\
		\textit{Cost:} cR #6
	\end{minipage}
	\par
}

%Narrative
\newcommand{\nrule}[3]{
	\begin{minipage}{\columnwidth}
		\section{#1}
		\textit{#2}\\
		\vspace{8mm}
		\begin{exampleblock}
			#3
		\end{exampleblock}
	\end{minipage}
	\par
}

%GM
\newcommand{\missiontype}[3]{\item \textbf{#1}: \textit{#2} #3}
